# Thufir Default Configuration
# Copy to ~/.thufir/config.yaml and customize

# Gateway settings (inherited from Clawdbot)
gateway:
  port: 18789
  bind: loopback
  auth:
    mode: password  # Required for remote access

# Agent settings
agent:
  # Primary LLM model
  model: claude-sonnet-4-5-20251101
  # OpenAI model (used for info gathering + execution)
  openaiModel: gpt-5.2
  # Executor model (orchestrator pattern)
  executorModel: gpt-5.2
  executorProvider: openai
  useExecutorModel: false
  useOrchestrator: false
  showToolTrace: false
  showCriticNotes: false
  showPlanTrace: false
  identityPromptMode: full
  internalPromptMode: minimal
  mentatAutoScan: false
  mentatSystem: Polymarket
  # Optional filters for mentat auto-scan
  # mentatMarketQuery: "macro"
  # mentatMarketLimit: 25
  # mentatIntelLimit: 40
  # Fallback model (faster, cheaper)
  fallbackModel: claude-3-5-haiku-20241022
  # Model provider: anthropic | openai | local
  provider: anthropic
  # OpenAI-compatible base URL (used for openai/local providers)
  apiBaseUrl: https://api.openai.com
  # Optional llm-mux proxy
  useProxy: false
  proxyBaseUrl: http://localhost:8317
  # Workspace directory
  workspace: ~/.thufir
  # Maximum thinking level
  thinkingLevel: high

# Wallet configuration
wallet:
  # Encrypted keystore location
  keystorePath: ~/.thufir/keystore.json

  # Spending limits (USD)
  limits:
    daily: 100          # Max spend per day
    perTrade: 25        # Max per single trade
    confirmationThreshold: 10  # Require confirmation above this

  # Risk controls
  exposure:
    maxPositionPercent: 20   # Max % of portfolio in one market
    maxDomainPercent: 40     # Max % in one domain

  # Loss protection
  cooldown:
    lossThresholdPercent: 10  # Trigger at 10% daily loss
    durationSeconds: 3600     # 1 hour cooldown

# Polymarket settings
polymarket:
  network: polygon
  rpcUrl: https://polygon-rpc.com
  # API endpoints
  api:
    gamma: https://gamma-api.polymarket.com
    clob: https://clob.polymarket.com
  stream:
    enabled: false
    wsUrl: ""            # optional WebSocket endpoint
    watchlistOnly: true
    maxWatchlist: 50
    reconnectSeconds: 10
    staleAfterSeconds: 180
    refreshIntervalSeconds: 300

# Execution mode
execution:
  # paper = simulated trades, webhook = forward orders to external executor
  mode: paper
  webhookUrl: ""

# Channel integrations
channels:
  telegram:
    enabled: false
    token: ""          # TELEGRAM_BOT_TOKEN
    allowedChatIds: [] # Restrict to these chat IDs (optional)
    pollingInterval: 5 # seconds
  whatsapp:
    enabled: false
    verifyToken: ""     # WHATSAPP_VERIFY_TOKEN
    accessToken: ""     # WHATSAPP_ACCESS_TOKEN
    phoneNumberId: ""   # WHATSAPP_PHONE_NUMBER_ID
    allowedNumbers: []  # E.164 numbers allowed to chat (optional)

# Autonomous scan loop
autonomy:
  enabled: true
  scanIntervalSeconds: 900
  maxMarketsPerScan: 10
  watchlistOnly: true
  eventDriven: false
  eventDrivenMinItems: 1

  # Full autonomous mode (auto-executes trades)
  fullAuto: false              # Master toggle for auto-execution
  minEdge: 0.05                # Minimum edge to trade (5%)
  requireHighConfidence: false # Only trade high-confidence opportunities
  pauseOnLossStreak: 3         # Pause after N consecutive losses
  dailyReportTime: "20:00"     # Time to send daily P&L report
  maxTradesPerScan: 3          # Max trades per scan cycle

# Memory persistence
memory:
  dbPath: ~/.thufir/thufir.sqlite
  sessionsPath: ~/.thufir/sessions
  maxHistoryMessages: 50
  compactAfterTokens: 12000
  keepRecentMessages: 12
  retentionDays: 90
  embeddings:
    enabled: false
    provider: openai     # openai | google
    model: text-embedding-3-small
    apiBaseUrl: https://api.openai.com

# Session routing (Clawdbot-style)
session:
  mainKey: main
  dmScope: per-channel-peer  # main | per-peer | per-channel-peer
  identityLinks: {}

# Multi-agent routing (optional)
# agents:
#   defaultAgentId: main
#   agentIds: [main, research]
#   routes:
#     - agentId: research
#       channel: telegram
#       peerIds: ["123456789"]
#   overrides:
#     research:
#       agent:
#         model: claude-sonnet-4-5-20251101
#       autonomy:
#         enabled: false

# Notifications / schedulers
notifications:
  briefing:
    enabled: false
    time: "08:00"
    channels: []
  dailyReport:
    enabled: false
    channels: []
  resolver:
    enabled: false
    time: "02:00"
    limit: 50
  intelFetch:
    enabled: false
    time: "06:00"
  marketSync:
    enabled: false
    time: "07:00"
    limit: 200
    maxPages: 25
    refreshLimit: 500
    # Set to run on a fixed interval instead of once per day
    # intervalSeconds: 900
  proactiveSearch:
    enabled: false
    mode: schedule
    time: "07:30"
    maxQueries: 8
    watchlistLimit: 20
    useLlm: true
    recentIntelLimit: 25
    extraQueries: []
    channels: []
  heartbeat:
    enabled: false
    intervalMinutes: 30
    channels: []
    target: last
  intelAlerts:
    enabled: false
    channels: []
    watchlistOnly: true
    maxItems: 10
    includeSources: []
    excludeSources: []
    includeKeywords: []
    excludeKeywords: []
    minKeywordOverlap: 1
    minTitleLength: 8
    # minSentiment: -1
    # maxSentiment: 1
    sentimentPreset: any
    includeEntities: []
    excludeEntities: []
    minEntityOverlap: 1
    useContent: true
    minScore: 0
    keywordWeight: 1
    entityWeight: 1
    sentimentWeight: 1
    positiveSentimentThreshold: 0.05
    negativeSentimentThreshold: -0.05
    showScore: false
    showReasons: false
    entityAliases: {}
  mentat:
    enabled: false
    time: "09:00"
    # intervalMinutes: 60
    channels: []
    system: Polymarket
    # marketQuery: "macro"
    marketLimit: 25
    intelLimit: 40
    minOverallScore: 0.7
    minDeltaScore: 0.15

# QMD local knowledge search
# QMD provides hybrid search (BM25 + vector + LLM reranking) for local knowledge
qmd:
  enabled: true
  knowledgePath: ~/.thufir/knowledge
  collections:
    - name: thufir-research
      description: Web search results and articles for prediction market research
    - name: thufir-intel
      description: News, social media intel, market commentary
    - name: thufir-markets
      description: Market analysis and trading notes
  # Auto-index web search results
  autoIndexWebSearch: true
  # Auto-index fetched web pages
  autoIndexWebFetch: false
  # Periodic embedding update schedule
  embedSchedule:
    enabled: true
    intervalMinutes: 60  # Run qmd embed every hour

# Intel sources
intel:
  embeddings:
    enabled: false
    provider: openai     # openai | google
    model: text-embedding-3-small
    apiBaseUrl: https://api.openai.com
  retentionDays: 30

  # Sources (configure API keys in environment)
  sources:
    # RSS feeds (free)
    rss:
      enabled: true
      feeds:
        - url: https://fivethirtyeight.com/feed/
          category: politics
        - url: https://www.federalreserve.gov/feeds/press_all.xml
          category: economics
        - url: https://techcrunch.com/feed/
          category: technology

    # Polymarket comments (free)
    polymarketComments:
      enabled: true
      trackWatchlist: true
      watchlistLimit: 50
      trackTopMarkets: 20
      maxCommentsPerMarket: 20

    # NewsAPI
    newsapi:
      enabled: false
      apiKey: ${NEWSAPI_KEY}
      categories: []
      countries: []
      queries: []
      maxArticlesPerFetch: 50
      language: en

    # Google News via SerpAPI
    googlenews:
      enabled: false
      serpApiKey: ${SERPAPI_KEY}
      queries: []
      country: us
      language: en
      maxArticlesPerFetch: 20

    # Twitter/X
    twitter:
      enabled: false
      bearerToken: ${TWITTER_BEARER}
      keywords: []
      accounts: []
      maxTweetsPerFetch: 25

  # Roaming controls for proactive search
  roaming:
    enabled: true
    allowSources: []
    allowTypes: []
    minTrust: medium
    socialOptIn: true
