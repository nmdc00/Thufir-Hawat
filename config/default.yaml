# Thufir Default Configuration
# Copy to ~/.thufir/config.yaml and customize

# Gateway settings (inherited from Clawdbot)
gateway:
  port: 18789
  bind: loopback
  auth:
    mode: password  # Required for remote access

# Agent settings
agent:
  # Primary LLM model
  model: claude-sonnet-4-5-20251101
  # OpenAI model (used for info gathering + execution)
  openaiModel: gpt-5.2
  # Executor model (orchestrator pattern)
  executorModel: gpt-5.2
  executorProvider: openai
  useExecutorModel: false
  useOrchestrator: false
  showToolTrace: false
  showCriticNotes: false
  showPlanTrace: false
  showFragilityTrace: false
  persistPlans: true
  allowFallbackNonCritical: true
  alwaysIncludeTime: false
  identityPromptMode: full
  identityBootstrapMaxChars: 20000
  identityBootstrapIncludeMissing: true
  maxPromptChars: 120000
  maxToolResultChars: 8000
  internalPromptMode: minimal
  mentatAutoScan: false
  mentatSystem: Markets
  # Optional filters for mentat auto-scan
  # mentatMarketQuery: "macro"
  # mentatMarketLimit: 25
  # mentatIntelLimit: 40
  # Fallback model (faster, cheaper)
  fallbackModel: claude-3-5-haiku-20241022
  # Model provider: anthropic | openai | local
  provider: anthropic
  # OpenAI-compatible base URL (used for openai provider)
  apiBaseUrl: https://api.openai.com
  # Local (Ollama) base URL for local provider
  localBaseUrl: http://localhost:11434
  # Optional llm-mux proxy
  useProxy: false
  proxyBaseUrl: http://localhost:8317
  # Workspace directory
  workspace: ~/.thufir
  # Maximum thinking level
  thinkingLevel: high
  # Trivial task offload (local LLM)
  trivialTaskProvider: local
  trivialTaskModel: qwen2.5:1.5b-instruct
  # Controlled system-side-effect tools (install/exec)
  systemTools:
    enabled: false
    allowedCommands: [node, npm, pnpm, bun, qmd]
    allowedManagers: [pnpm, npm, bun]
    allowGlobalInstall: false
    timeoutMs: 120000
    maxOutputChars: 12000
  trivial:
    enabled: true
    maxTokens: 256
    temperature: 0.2
    timeoutMs: 30000
  # Global LLM budget (rolling hour)
  llmBudget:
    enabled: true
    maxCallsPerHour: 120
    maxTokensPerHour: 120000
    reserveCalls: 10
    reserveTokens: 10000
    includeLocal: false

# Wallet configuration
wallet:
  # Encrypted keystore location
  keystorePath: ~/.thufir/keystore.json
  # Optional RPC URL for live execution adapters
  # rpcUrl: ""

  # Spending limits (USD)
  limits:
    daily: 100          # Max spend per day
    perTrade: 25        # Max per single trade
    confirmationThreshold: 10  # Require confirmation above this

  # Risk controls
  exposure:
    maxPositionPercent: 20   # Max % of portfolio in one market
    maxDomainPercent: 40     # Max % in one domain

  # Perp risk controls
  perps:
    maxLeverage: 5              # Max leverage allowed on perps
    maxOrderNotionalUsd: 250    # Max notional per perp order (USD)
    maxTotalNotionalUsd: 1000   # Max total perp notional across positions (USD)
    minLiquidationDistanceBps: 500 # Minimum liquidation distance (bps) when data available
    correlationCaps: []         # Optional: [{ name, symbols, maxNotionalUsd }]

  # Loss protection
  cooldown:
    lossThresholdPercent: 10  # Trigger at 10% daily loss
    durationSeconds: 3600     # 1 hour cooldown

# Technical analysis (short-term crypto)
technical:
  enabled: false
  priceSource: binance
  symbols:
    - 'BTC/USDT'
    - 'ETH/USDT'
  timeframes:
    - '1h'
    - '4h'
    - '1d'
  indicators:
    rsi:
      period: 14
      overbought: 70
      oversold: 30
    macd:
      fast: 12
      slow: 26
      signal: 9
    bollingerBands:
      period: 20
      stdDev: 2
  signals:
    minConfidence: 0.5
    weights:
      technical: 0.5
      news: 0.3
      onChain: 0.2
  onChain:
    enabled: false
    coinglassApiKey: ""

# Execution mode
execution:
  # paper = simulated trades, webhook = forward orders to external executor
  mode: paper
  provider: hyperliquid
  webhookUrl: ""

# Channel integrations
channels:
  telegram:
    enabled: false
    token: ""          # TELEGRAM_BOT_TOKEN
    allowedChatIds: [] # Restrict to these chat IDs (optional)
    pollingInterval: 5 # seconds
  whatsapp:
    enabled: false
    verifyToken: ""     # WHATSAPP_VERIFY_TOKEN
    accessToken: ""     # WHATSAPP_ACCESS_TOKEN
    phoneNumberId: ""   # WHATSAPP_PHONE_NUMBER_ID
    allowedNumbers: []  # E.164 numbers allowed to chat (optional)

# Autonomous scan loop
autonomy:
  enabled: true
  scanIntervalSeconds: 900
  maxMarketsPerScan: 10
  watchlistOnly: true
  eventDriven: false
  eventDrivenMinItems: 1
  strategy: discovery
  probeRiskFraction: 0.005

  # Full autonomous mode (auto-executes trades)
  fullAuto: false              # Master toggle for auto-execution
  minEdge: 0.05                # Minimum edge to trade (5%)
  requireHighConfidence: false # Only trade high-confidence opportunities
  pauseOnLossStreak: 3         # Pause after N consecutive losses
  dailyReportTime: "20:00"     # Time to send daily P&L report
  maxTradesPerScan: 3          # Max trades per scan cycle

# Memory persistence
memory:
  dbPath: ~/.thufir/thufir.sqlite
  sessionsPath: ~/.thufir/sessions
  maxHistoryMessages: 50
  compactAfterTokens: 12000
  keepRecentMessages: 12
  retentionDays: 90
  embeddings:
    enabled: false
    provider: openai     # openai | google
    model: text-embedding-3-small
    apiBaseUrl: https://api.openai.com

# Session routing (Clawdbot-style)
session:
  mainKey: main
  dmScope: per-channel-peer  # main | per-peer | per-channel-peer
  identityLinks: {}

# Multi-agent routing (optional)
# agents:
#   defaultAgentId: main
#   agentIds: [main, research]
#   routes:
#     - agentId: research
#       channel: telegram
#       peerIds: ["123456789"]
#   overrides:
#     research:
#       agent:
#         model: claude-sonnet-4-5-20251101
#       autonomy:
#         enabled: false

# Notifications / schedulers
notifications:
  briefing:
    enabled: false
    time: "08:00"
    channels: []
  dailyReport:
    enabled: false
    channels: []
  intelFetch:
    enabled: false
    time: "06:00"
  marketSync:
    enabled: false
    time: "07:00"
    limit: 200
    maxPages: 25
    refreshLimit: 500
    # Set to run on a fixed interval instead of once per day
    # intervalSeconds: 900
  proactiveSearch:
    enabled: false
    mode: schedule
    time: "07:30"
    maxQueries: 8
    iterations: 2
    watchlistLimit: 20
    useLlm: true
    recentIntelLimit: 25
    extraQueries: []
    includeLearnedQueries: true
    learnedQueryLimit: 8
    webLimitPerQuery: 5
    fetchPerQuery: 1
    fetchMaxChars: 4000
    channels: []
  heartbeat:
    enabled: false
    intervalMinutes: 30
    channels: []
    target: last
  intelAlerts:
    enabled: false
    channels: []
    watchlistOnly: true
    maxItems: 10
    includeSources: []
    excludeSources: []
    includeKeywords: []
    excludeKeywords: []
    minKeywordOverlap: 1
    minTitleLength: 8
    # minSentiment: -1
    # maxSentiment: 1
    sentimentPreset: any
    includeEntities: []
    excludeEntities: []
    minEntityOverlap: 1
    useContent: true
    minScore: 0
    keywordWeight: 1
    entityWeight: 1
    sentimentWeight: 1
    positiveSentimentThreshold: 0.05
    negativeSentimentThreshold: -0.05
    showScore: false
    showReasons: false
    entityAliases: {}
  mentat:
    enabled: false
    time: "09:00"
    # intervalMinutes: 60
    channels: []
    system: Hyperliquid
    # marketQuery: "macro"
    marketLimit: 25
    intelLimit: 40
    minOverallScore: 0.7
    minDeltaScore: 0.15
    # schedules:
    #   - name: hourly
    #     intervalMinutes: 60
    #     marketLimit: 15
    #     intelLimit: 20
    #   - name: daily
    #     time: "09:00"
    #     marketLimit: 25
    #     intelLimit: 40

# QMD local knowledge search
# QMD provides hybrid search (BM25 + vector + LLM reranking) for local knowledge
qmd:
  enabled: true
  knowledgePath: ~/.thufir/knowledge
  collections:
    - name: thufir-research
      description: Web search results and articles for market research
    - name: thufir-intel
      description: News, social media intel, market commentary
    - name: thufir-markets
      description: Market analysis and trading notes
  # Auto-index web search results
  autoIndexWebSearch: true
  # Auto-index fetched web pages
  autoIndexWebFetch: false
  # Periodic embedding update schedule
  embedSchedule:
    enabled: true
    intervalMinutes: 60  # Run qmd embed every hour

# Intel sources
intel:
  embeddings:
    enabled: false
    provider: openai     # openai | google
    model: text-embedding-3-small
    apiBaseUrl: https://api.openai.com
  retentionDays: 30

  # Sources (configure API keys in environment)
  sources:
    # RSS feeds (free)
    rss:
      enabled: true
      feeds:
        - url: https://fivethirtyeight.com/feed/
          category: politics
        - url: https://www.federalreserve.gov/feeds/press_all.xml
          category: economics
        - url: https://techcrunch.com/feed/
          category: technology

    # NewsAPI
    newsapi:
      enabled: false
      apiKey: ${NEWSAPI_KEY}
      categories: []
      countries: []
      queries: []
      maxArticlesPerFetch: 50
      language: en

    # Google News via SerpAPI
    googlenews:
      enabled: false
      serpApiKey: ${SERPAPI_KEY}
      queries: []
      country: us
      language: en
      maxArticlesPerFetch: 20

    # Twitter/X
    twitter:
      enabled: false
      bearerToken: ${TWITTER_BEARER}
      keywords: []
      accounts: []
      maxTweetsPerFetch: 25

  # Roaming controls for proactive search
  roaming:
    enabled: true
    allowSources: []
    allowTypes: []
    minTrust: medium
    socialOptIn: true
# Hyperliquid settings
hyperliquid:
  enabled: true
  baseUrl: https://api.hyperliquid.xyz
  wsUrl: wss://api.hyperliquid.xyz/ws
  accountAddress: ""
  privateKey: ""
  maxLeverage: 5
  defaultSlippageBps: 10
  symbols: ["BTC", "ETH"]
